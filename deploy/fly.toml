# Configuração do Fly.io para PocketBase
# Documentação: https://fly.io/docs/reference/configuration/

# Nome do app (você pode mudar)
# Deve ser único no Fly.io (como um domínio)
app = "prontuario-pocketbase"

# Região primária (gru = São Paulo, Brasil)
primary_region = "gru"

# Como construir a imagem Docker
[build]
  # Usa o Dockerfile específico do PocketBase
  dockerfile = "deploy/Dockerfile.pocketbase"

# Volume persistente para os dados
# IMPORTANTE: Sem isso, seus dados somem a cada deploy!
[mounts]
  source = "pb_data"
  destination = "/app/pb_data"
  initial_size = "1gb"

# Configuração da VM
[http_service]
  internal_port = 8090
  force_https = true
  auto_stop_machines = false
  auto_start_machines = true
  min_machines_running = 1
  
  # Processo de saúde (health check)
  [http_service.checks]
    interval = "15s"
    timeout = "5s"
    grace_period = "10s"
    method = "GET"
    path = "/api/health"

# Tamanho da VM (shared-cpu-1x = plano grátis)
[[vm]]
  memory = '256mb'
  cpu_kind = 'shared'
  cpus = 1

